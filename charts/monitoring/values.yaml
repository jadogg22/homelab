# charts/monitoring/values.yaml
# Global settings
global:
  imageRegistry: ""
  imagePullSecrets: []
  defaultStorageClass: ""
  security:
    allowInsecureImages: false
  compatibility:
    openshift:
      adaptSecurityContext: auto

# ---------------------------------------------------------------------
# 1. Prometheus Operator (NEEDS LEGACY IMAGE FIX)
# ---------------------------------------------------------------------
operator:
  enabled: true
  resourcesPreset: nano
  # Fix: Point to legacy repo
  image:
    registry: docker.io
    repository: bitnamilegacy/prometheus-operator
    tag: 0.85.0-debian-12-r0
  serviceAccount:
    create: true
  service:
    type: ClusterIP
  serviceMonitor:
    enabled: true
  podSecurityContext:
    enabled: true
    fsGroup: 1001
  containerSecurityContext:
    enabled: true
    runAsUser: 1001
    runAsGroup: 1001
    runAsNonRoot: true
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false
    capabilities:
      drop: ["ALL"]

# ---------------------------------------------------------------------
# 2. Prometheus (NEEDS LEGACY IMAGE FIX)
# ---------------------------------------------------------------------
prometheus:
  enabled: true
  resourcesPreset: nano
  # Fix: Point to legacy repo
  image:
    registry: docker.io
    repository: bitnamilegacy/prometheus
    tag: 2.54.1-debian-12-r0
  serviceAccount:
    create: true
    automountServiceAccountToken: false
  podSecurityContext:
    enabled: true
    fsGroup: 1001
  containerSecurityContext:
    enabled: true
    runAsUser: 1001
    runAsGroup: 1001
    runAsNonRoot: true
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false
    capabilities:
      drop: ["ALL"]
  service:
    type: ClusterIP
  pdb:
    create: true
  networkPolicy:
    enabled: true
  
  # Simplified Ingress Config
  ingress:
    enabled: true
    ingressClassName: traefik
    hostname: prometheus.jadogg.com
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
    tls: true
    extraTls:
      - secretName: jadogg-wildcard-cert
        hosts:
          - prometheus.jadogg.com

# ---------------------------------------------------------------------
# 3. Grafana
# ---------------------------------------------------------------------
grafana:
  enabled: true
  resourcesPreset: nano
  adminUser: admin
  adminPassword: "changeme" # Don't forget to update this later!
  
  # Simplified Ingress Config
  ingress:
    enabled: true
    ingressClassName: traefik
    hostname: grafana.jadogg.com
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
    tls: true
    extraTls:
      - secretName: jadogg-wildcard-cert
        hosts:
          - grafana.jadogg.com
  
  service:
    type: ClusterIP
  persistence:
    enabled: true
    storageClassName: "" # Uses default if empty
    accessModes:
      - ReadWriteOnce
    size: 10Gi

# ---------------------------------------------------------------------
# 4. Node Exporter & Kube State Metrics (NEEDS LEGACY IMAGE FIX)
# ---------------------------------------------------------------------
nodeExporter:
  enabled: true

kubeStateMetrics:
  enabled: true
  # Fix: Point to legacy repo
  image:
    registry: docker.io
    repository: bitnamilegacy/kube-state-metrics
    tag: 2.16.0-debian-12-r5

# ---------------------------------------------------------------------
# 5. Blackbox Exporter (You had this one correct!)
# ---------------------------------------------------------------------
blackboxExporter:
  image:
    registry: docker.io
    repository: bitnamilegacy/blackbox-exporter
    tag: 0.27.0-debian-12-r4
